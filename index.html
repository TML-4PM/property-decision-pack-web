<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Property Decision Pack | Troy & Cassandra</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #f8f9fa;
            --card: #ffffff;
            --text: #1a1a2e;
            --text-muted: #6b7280;
            --accent: #2563eb;
            --accent-light: #dbeafe;
            --success: #059669;
            --success-light: #d1fae5;
            --warning: #d97706;
            --warning-light: #fef3c7;
            --danger: #dc2626;
            --danger-light: #fee2e2;
            --border: #e5e7eb;
            --shadow: 0 1px 3px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
            --radius: 12px;
            --radius-sm: 8px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Skip link for accessibility */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--accent);
            color: white;
            padding: 8px 16px;
            z-index: 100;
            transition: top 0.3s;
        }
        .skip-link:focus {
            top: 0;
        }

        /* Header */
        header {
            background: var(--card);
            border-bottom: 1px solid var(--border);
            padding: 1rem 1.5rem;
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            font-weight: 700;
            font-size: 1.25rem;
            color: var(--text);
        }
        .logo span {
            color: var(--accent);
        }

        nav {
            display: flex;
            gap: 0.5rem;
        }

        .nav-btn {
            padding: 0.5rem 1rem;
            border: none;
            background: transparent;
            color: var(--text-muted);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            border-radius: var(--radius-sm);
            transition: all 0.2s;
        }
        .nav-btn:hover, .nav-btn.active {
            background: var(--accent-light);
            color: var(--accent);
        }
        .nav-btn:focus {
            outline: 3px solid var(--accent);
            outline-offset: 2px;
        }

        @media (max-width: 768px) {
            nav { display: none; }
        }

        /* Main content */
        main {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        /* Sections */
        section {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        h2 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .subtitle {
            color: var(--text-muted);
            margin-bottom: 1.5rem;
        }

        /* Cards */
        .card {
            background: var(--card);
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            margin-bottom: 1rem;
        }

        /* Key Numbers Grid */
        .key-numbers {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--card);
            border-radius: var(--radius);
            padding: 1.25rem;
            box-shadow: var(--shadow);
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--text-muted);
            margin-bottom: 0.25rem;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }

        .stat-value.positive { color: var(--success); }
        .stat-value.negative { color: var(--danger); }
        .stat-value.warning { color: var(--warning); }

        /* Options Grid */
        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1rem;
        }

        .option-card {
            background: var(--card);
            border-radius: var(--radius);
            padding: 1.25rem;
            box-shadow: var(--shadow);
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .option-card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .option-card.selected {
            border-color: var(--accent);
            background: var(--accent-light);
        }

        .option-card.recommended {
            border-color: var(--success);
        }

        .option-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.75rem;
        }

        .option-code {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--accent);
        }

        .option-name {
            font-weight: 600;
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }

        .option-desc {
            font-size: 0.875rem;
            color: var(--text-muted);
            margin-bottom: 1rem;
        }

        .badge {
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            text-transform: uppercase;
        }

        .badge-success { background: var(--success-light); color: var(--success); }
        .badge-warning { background: var(--warning-light); color: var(--warning); }
        .badge-danger { background: var(--danger-light); color: var(--danger); }
        .badge-info { background: var(--accent-light); color: var(--accent); }

        .option-metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }

        .metric {
            text-align: center;
            padding: 0.5rem;
            background: var(--bg);
            border-radius: var(--radius-sm);
        }

        .metric-label {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .metric-value {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            font-size: 0.9rem;
        }

        /* Comparison Table */
        .table-wrap {
            overflow-x: auto;
            margin: 1rem 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
        }

        th, td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: var(--bg);
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        tr:hover {
            background: var(--bg);
        }

        .mono {
            font-family: 'JetBrains Mono', monospace;
        }

        /* Chat Interface */
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 500px;
            background: var(--card);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .chat-message {
            display: flex;
            gap: 0.75rem;
            max-width: 85%;
        }

        .chat-message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .chat-bubble {
            padding: 0.75rem 1rem;
            border-radius: var(--radius);
            font-size: 0.9rem;
        }

        .chat-message.assistant .chat-bubble {
            background: var(--bg);
        }

        .chat-message.user .chat-bubble {
            background: var(--accent);
            color: white;
        }

        .chat-input-area {
            display: flex;
            gap: 0.5rem;
            padding: 1rem;
            border-top: 1px solid var(--border);
        }

        .chat-input {
            flex: 1;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: 1rem;
            font-family: inherit;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-light);
        }

        .chat-send {
            padding: 0.75rem 1.5rem;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .chat-send:hover {
            background: #1d4ed8;
        }

        .quick-questions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            border-top: 1px solid var(--border);
            background: var(--bg);
        }

        .quick-q {
            padding: 0.5rem 0.75rem;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 9999px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quick-q:hover {
            background: var(--accent-light);
            border-color: var(--accent);
        }

        /* Split Calculator */
        .split-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
        }

        .split-card {
            background: var(--card);
            border-radius: var(--radius);
            padding: 1.25rem;
            box-shadow: var(--shadow);
        }

        .split-rule {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .split-values {
            display: flex;
            gap: 1rem;
            margin-top: 0.75rem;
        }

        .split-person {
            flex: 1;
            text-align: center;
            padding: 0.75rem;
            background: var(--bg);
            border-radius: var(--radius-sm);
        }

        .split-name {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 0.25rem;
        }

        .split-amount {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            color: var(--success);
        }

        /* Stress Test */
        .stress-table {
            width: 100%;
        }

        .runway-bar {
            height: 8px;
            background: var(--bg);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .runway-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        /* Mobile FAB */
        .fab-menu {
            display: none;
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            z-index: 100;
        }

        @media (max-width: 768px) {
            .fab-menu {
                display: block;
            }
        }

        .fab-btn {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: var(--accent);
            color: white;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            transition: transform 0.2s;
        }

        .fab-btn:hover {
            transform: scale(1.1);
        }

        .fab-options {
            position: absolute;
            bottom: 70px;
            right: 0;
            background: var(--card);
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            display: none;
            min-width: 180px;
        }

        .fab-options.open {
            display: block;
            animation: slideUp 0.2s ease;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fab-option {
            display: block;
            width: 100%;
            padding: 0.75rem 1rem;
            text-align: left;
            border: none;
            background: none;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .fab-option:hover {
            background: var(--bg);
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--text);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 200;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* Preference indicator */
        .preference-banner {
            background: var(--success-light);
            border: 1px solid var(--success);
            border-radius: var(--radius);
            padding: 1rem;
            margin-bottom: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .preference-text {
            font-weight: 500;
        }

        .clear-pref {
            background: none;
            border: none;
            color: var(--danger);
            cursor: pointer;
            font-size: 0.875rem;
        }

        /* Print styles */
        @media print {
            header, nav, .fab-menu, .chat-input-area, .quick-questions { display: none; }
            section { display: block !important; page-break-inside: avoid; }
            .card { box-shadow: none; border: 1px solid #ddd; }
        }

        /* Loading */
        .loading {
            position: fixed;
            inset: 0;
            background: rgba(255,255,255,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 300;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading.hidden {
            display: none;
        }
    </style>
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <div class="loading" id="loading">
        <div class="spinner"></div>
    </div>

    <header>
        <div class="header-content">
            <div class="logo">Property<span>Pack</span></div>
            <nav role="tablist" aria-label="Main navigation">
                <button class="nav-btn active" role="tab" aria-selected="true" onclick="showSection('overview')" data-section="overview">Overview</button>
                <button class="nav-btn" role="tab" aria-selected="false" onclick="showSection('options')" data-section="options">Options</button>
                <button class="nav-btn" role="tab" aria-selected="false" onclick="showSection('compare')" data-section="compare">Compare</button>
                <button class="nav-btn" role="tab" aria-selected="false" onclick="showSection('stress')" data-section="stress">Stress Test</button>
                <button class="nav-btn" role="tab" aria-selected="false" onclick="showSection('splits')" data-section="splits">Splits</button>
                <button class="nav-btn" role="tab" aria-selected="false" onclick="showSection('chat')" data-section="chat">Ask Questions</button>
            </nav>
        </div>
    </header>

    <main id="main-content">
        <!-- OVERVIEW SECTION -->
        <section id="overview" class="active" role="tabpanel" aria-labelledby="tab-overview">
            <h1>Property Decision Pack</h1>
            <p class="subtitle">Troy & Cassandra ‚Ä¢ Modelling only, not financial advice</p>

            <div id="preference-display"></div>

            <div class="key-numbers" role="region" aria-label="Key financial numbers">
                <div class="stat-card">
                    <div class="stat-label">Seabrook Value</div>
                    <div class="stat-value">$3.19M</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Peninsular Value</div>
                    <div class="stat-value">$1.68M</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Combined Equity</div>
                    <div class="stat-value positive">$2.43M</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Combined Debt</div>
                    <div class="stat-value negative">$2.44M</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Net if Sell Both</div>
                    <div class="stat-value positive">$2.30M</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Recommended</div>
                    <div class="stat-value" style="color: var(--accent)">B2</div>
                </div>
            </div>

            <div class="card">
                <h2>üéØ Recommended Option: B2</h2>
                <p><strong>Sell Peninsular, keep Seabrook, keep 12-month buffer</strong></p>
                <p style="margin-top: 0.5rem; color: var(--text-muted);">Best balance of reduced stress, staying in market, and keeping a safety runway. Cassandra's value protected via preserved credit mechanism.</p>
                <div style="margin-top: 1rem; display: flex; gap: 1rem; flex-wrap: wrap;">
                    <span class="badge badge-success">Low-Medium Risk</span>
                    <span class="badge badge-info">$129k Buffer</span>
                    <span class="badge badge-warning">$807k Debt</span>
                </div>
            </div>

            <div class="card">
                <h2>üìä Quick Summary</h2>
                <div class="table-wrap">
                    <table>
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Current</th>
                                <th>After B2</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Total Debt</td>
                                <td class="mono">$2,440,406</td>
                                <td class="mono" style="color: var(--success)">$936,060</td>
                            </tr>
                            <tr>
                                <td>Monthly Repayment (7%)</td>
                                <td class="mono">$10,751</td>
                                <td class="mono" style="color: var(--success)">~$6,200</td>
                            </tr>
                            <tr>
                                <td>Cash Buffer</td>
                                <td class="mono">$0</td>
                                <td class="mono" style="color: var(--success)">$129,014</td>
                            </tr>
                            <tr>
                                <td>Properties</td>
                                <td>2</td>
                                <td>1 (Seabrook)</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- OPTIONS SECTION -->
        <section id="options" role="tabpanel" aria-labelledby="tab-options">
            <h1>All Options</h1>
            <p class="subtitle">Click any option to mark as your preference</p>

            <div id="preference-display-options"></div>

            <div class="options-grid" id="options-grid" role="list">
                <!-- Generated by JS -->
            </div>
        </section>

        <!-- COMPARE SECTION -->
        <section id="compare" role="tabpanel" aria-labelledby="tab-compare">
            <h1>Compare Options</h1>
            <p class="subtitle">Side-by-side comparison of all scenarios</p>

            <div class="card">
                <div class="table-wrap">
                    <table id="compare-table">
                        <thead>
                            <tr>
                                <th>Code</th>
                                <th>Option</th>
                                <th>Debt After</th>
                                <th>Cash After</th>
                                <th>Risk</th>
                                <th>Move Cost</th>
                            </tr>
                        </thead>
                        <tbody id="compare-tbody">
                            <!-- Generated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- STRESS TEST SECTION -->
        <section id="stress" role="tabpanel" aria-labelledby="tab-stress">
            <h1>Stress Test</h1>
            <p class="subtitle">What happens if income stops?</p>

            <div class="card">
                <h2>Weekly Cashflow & Runway</h2>
                <div class="table-wrap">
                    <table>
                        <thead>
                            <tr>
                                <th>Option</th>
                                <th>Weekly Mortgage</th>
                                <th>Net Cashflow</th>
                                <th>Buffer</th>
                                <th>Runway</th>
                            </tr>
                        </thead>
                        <tbody id="stress-tbody">
                            <!-- Generated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card">
                <h2>Interest Rate Sensitivity</h2>
                <div class="table-wrap">
                    <table>
                        <thead>
                            <tr>
                                <th>Rate</th>
                                <th>Current Loan/month</th>
                                <th>Reduced Loan/month</th>
                                <th>Monthly Savings</th>
                            </tr>
                        </thead>
                        <tbody id="rate-tbody">
                            <!-- Generated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- SPLITS SECTION -->
        <section id="splits" role="tabpanel" aria-labelledby="tab-splits">
            <h1>Split Scenarios</h1>
            <p class="subtitle">Different ways to divide if selling both</p>

            <div class="split-grid" id="split-grid">
                <!-- Generated by JS -->
            </div>
        </section>

        <!-- CHAT SECTION -->
        <section id="chat" role="tabpanel" aria-labelledby="tab-chat">
            <h1>Ask Questions</h1>
            <p class="subtitle">Get answers about your options</p>

            <div class="chat-container">
                <div class="chat-messages" id="chat-messages" role="log" aria-live="polite">
                    <div class="chat-message assistant">
                        <div class="chat-bubble">
                            Hi! I can help you understand your property options. Try asking about:
                            <ul style="margin: 0.5rem 0 0 1rem;">
                                <li>What's the safest option?</li>
                                <li>Compare keeping vs selling</li>
                                <li>What happens if rates rise?</li>
                                <li>How do splits work?</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="quick-questions">
                    <button class="quick-q" onclick="askQuestion('What is the safest option?')">Safest option?</button>
                    <button class="quick-q" onclick="askQuestion('Compare B2 vs keeping both')">B2 vs Keep Both</button>
                    <button class="quick-q" onclick="askQuestion('What if rates rise to 8%?')">Rate rise impact</button>
                    <button class="quick-q" onclick="askQuestion('How is the split calculated?')">Split rules</button>
                    <button class="quick-q" onclick="askQuestion('What is move friction?')">Move friction?</button>
                    <button class="quick-q" onclick="askQuestion('Why sell Peninsular not Seabrook?')">Why Peninsular?</button>
                </div>
                <div class="chat-input-area">
                    <input type="text" class="chat-input" id="chat-input" placeholder="Ask a question..." aria-label="Ask a question" onkeypress="if(event.key==='Enter')sendChat()">
                    <button class="chat-send" onclick="sendChat()" aria-label="Send message">Send</button>
                </div>
            </div>
        </section>
    </main>

    <!-- Mobile FAB Menu -->
    <div class="fab-menu">
        <div class="fab-options" id="fab-options">
            <button class="fab-option" onclick="showSection('overview');toggleFab()">üìä Overview</button>
            <button class="fab-option" onclick="showSection('options');toggleFab()">üè† Options</button>
            <button class="fab-option" onclick="showSection('compare');toggleFab()">‚öñÔ∏è Compare</button>
            <button class="fab-option" onclick="showSection('stress');toggleFab()">üß™ Stress Test</button>
            <button class="fab-option" onclick="showSection('splits');toggleFab()">üí∞ Splits</button>
            <button class="fab-option" onclick="showSection('chat');toggleFab()">üí¨ Questions</button>
        </div>
        <button class="fab-btn" onclick="toggleFab()" aria-label="Navigation menu" aria-expanded="false">‚ò∞</button>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script>
    // Data
    const DATA = {
        options: [
            { code: "A", name: "Keep both houses", description: "No sale. Formalise internal settlement.", debt_after: 2440406, cash_after: 0, move_friction: 0, risk: "High", recommended: false },
            { code: "B1", name: "Sell Peninsular, pay all into Seabrook", description: "Maximum debt reduction.", debt_after: 807046, cash_after: 0, move_friction: 0, risk: "Medium", recommended: false },
            { code: "B2", name: "Sell Peninsular, keep 1-year buffer", description: "Keep 12 months of repayments as safety buffer.", debt_after: 936060, cash_after: 129014, move_friction: 0, risk: "Low-Medium", recommended: true },
            { code: "B3", name: "Sell Peninsular, put into offset", description: "Interest drops but liquidity preserved.", debt_after: 1615977, cash_after: 0, move_friction: 0, risk: "Medium", recommended: false },
            { code: "C", name: "Sell Peninsular, rent Seabrook out", description: "Rent Seabrook, family lives with relatives.", debt_after: 807046, cash_after: 0, move_friction: 30000, risk: "Medium", recommended: false },
            { code: "D1", name: "Sell Seabrook, keep Peninsular", description: "Debt free with large buffer.", debt_after: 0, cash_after: 666324, move_friction: 130000, risk: "Very Low", recommended: false },
            { code: "D2", name: "Sell Seabrook, rent Peninsular", description: "Rent Peninsular out.", debt_after: 0, cash_after: 666324, move_friction: 130000, risk: "Low", recommended: false },
            { code: "E1", name: "Sell both, hold cash", description: "Maximum flexibility. Rent while deciding.", debt_after: 0, cash_after: 2299683, move_friction: 130000, risk: "Flexible", recommended: false },
            { code: "E2", name: "Sell both, buy new quickly", description: "Clean slate with ideal home.", debt_after: 0, cash_after: 2169683, move_friction: 130000, risk: "Medium", recommended: false },
            { code: "F", name: "Keep both, formalise agreement", description: "Write formal ownership agreement.", debt_after: 2440406, cash_after: 0, move_friction: 0, risk: "High", recommended: false },
            { code: "G", name: "Sell both, live with family", description: "Hold cash, buy when ready.", debt_after: 0, cash_after: 2169683, move_friction: 130000, risk: "Medium", recommended: false },
            { code: "H", name: "Sell Peninsular, aggressive payoff", description: "Kill loan fast (~8 years).", debt_after: 807046, cash_after: 0, move_friction: 0, risk: "Medium", recommended: false }
        ],
        stress: [
            { option: "Keep both (current)", weekly_mortgage: 2481, net_cashflow: -2481, buffer: 0, runway: 0 },
            { option: "Sell Pen, pay all in", weekly_mortgage: 1239, net_cashflow: -1239, buffer: 0, runway: 0 },
            { option: "B2: Sell Pen, keep buffer", weekly_mortgage: 1437, net_cashflow: -1437, buffer: 129014, runway: 89.8 },
            { option: "Sell Pen, rent Seabrook", weekly_mortgage: 1239, net_cashflow: -89, buffer: 0, runway: 0 },
            { option: "Sell Seabrook, keep Pen", weekly_mortgage: 0, net_cashflow: 0, buffer: 666324, runway: "‚àû" },
            { option: "Sell both", weekly_mortgage: 0, net_cashflow: 0, buffer: 2169683, runway: "‚àû" }
        ],
        rates: [
            { rate: "5.5%", current: 9176, reduced: 4583, savings: 4593 },
            { rate: "6.0%", current: 9688, reduced: 4839, savings: 4849 },
            { rate: "6.5%", current: 10214, reduced: 5101, savings: 5113 },
            { rate: "7.0%", current: 10751, reduced: 5369, savings: 5382 },
            { rate: "7.5%", current: 11299, reduced: 5643, savings: 5656 }
        ],
        splits: [
            { rule: "50/50 equal", cassandra: 1149842, troy: 1149842, note: "Simple equal split" },
            { rule: "70/30 to Cassandra", cassandra: 1609778, troy: 689905, note: "Proposed ratio" },
            { rule: "Each keeps own sale net", cassandra: 808930, troy: 1490753, note: "By property ownership" },
            { rule: "Cass gets Pen first, then 70/30", cassandra: 1852457, troy: 447226, note: "Preserves Pen value first" },
            { rule: "60/40 to Cassandra", cassandra: 1379810, troy: 919873, note: "Middle ground" },
            { rule: "Proportional to title", cassandra: 1450000, troy: 849683, note: "Based on ownership %" }
        ],
        qa: {
            "safest": "The safest options are D1 (Sell Seabrook, keep Peninsular debt-free) or E1 (Sell both, hold cash). Both give you zero debt and large cash buffers. D1 gives $666k buffer, E1 gives $2.3M buffer. B2 is the safest option if you want to stay in Seabrook - gives $129k buffer (90 weeks runway).",
            "b2": "B2 (Sell Peninsular, keep 1-year buffer) reduces your debt from $2.44M to $936k. Monthly repayments drop from ~$10,750 to ~$6,200. You keep $129k cash buffer (90 weeks runway). Compared to keeping both: you lose Peninsular's growth potential but gain massive stress reduction.",
            "rate": "If rates rise to 7.5%, your current monthly repayment jumps from $10,751 to $11,299 (+$548/month). With reduced loan (after selling Pen): rises from $5,369 to $5,643 (+$274/month). Selling Peninsular cuts your rate exposure in half.",
            "split": "Six split options exist: 50/50 gives each ~$1.15M. 70/30 gives Cassandra $1.61M. 'Each keeps own' gives Troy more ($1.49M vs $809k) because Seabrook is worth more. The 'Cass gets Pen first' option protects her original asset value.",
            "friction": "Move friction = moving costs (~$30k) + contents writeoff (~$100k). Furniture bought retail can't be resold at value. Moving from Seabrook = $130k friction. Staying in Seabrook = $0 friction.",
            "peninsular": "Sell Peninsular not Seabrook because: 1) You prefer living in Seabrook, 2) Seabrook has more growth potential ($3.19M vs $1.68M - same % gain = more $), 3) Moving from Seabrook costs $130k in friction, 4) Cassandra's equity is protected via preserved credit mechanism.",
            "default": "I can help with questions about your property options. Try asking about the safest option, comparing B2 vs keeping both, rate rise impacts, how splits work, move friction costs, or why sell Peninsular."
        }
    };

    // Format money
    function fmt(n) {
        if (n === null || n === undefined) return '-';
        return '$' + Math.abs(n).toLocaleString('en-AU', { maximumFractionDigits: 0 });
    }

    // Get risk badge class
    function riskBadge(risk) {
        const map = {
            'Very Low': 'badge-success',
            'Low': 'badge-success',
            'Low-Medium': 'badge-success',
            'Medium': 'badge-warning',
            'High': 'badge-danger',
            'Flexible': 'badge-info'
        };
        return map[risk] || 'badge-info';
    }

    // Render options grid
    function renderOptions() {
        const grid = document.getElementById('options-grid');
        const pref = localStorage.getItem('property_preference');
        
        grid.innerHTML = DATA.options.map(opt => `
            <div class="option-card ${opt.recommended ? 'recommended' : ''} ${pref === opt.code ? 'selected' : ''}" 
                 role="listitem" 
                 tabindex="0"
                 onclick="selectOption('${opt.code}')"
                 onkeypress="if(event.key==='Enter')selectOption('${opt.code}')">
                <div class="option-header">
                    <span class="option-code">${opt.code}</span>
                    <span class="badge ${riskBadge(opt.risk)}">${opt.risk}</span>
                </div>
                <div class="option-name">${opt.name}</div>
                <div class="option-desc">${opt.description}</div>
                <div class="option-metrics">
                    <div class="metric">
                        <div class="metric-label">Debt After</div>
                        <div class="metric-value" style="color: ${opt.debt_after === 0 ? 'var(--success)' : 'var(--danger)'}">${fmt(opt.debt_after)}</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">Cash After</div>
                        <div class="metric-value" style="color: ${opt.cash_after > 0 ? 'var(--success)' : 'var(--text-muted)'}">${fmt(opt.cash_after)}</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">Move Cost</div>
                        <div class="metric-value">${opt.move_friction === 0 ? '-' : fmt(opt.move_friction)}</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">Status</div>
                        <div class="metric-value">${opt.recommended ? '‚≠ê Rec' : '-'}</div>
                    </div>
                </div>
            </div>
        `).join('');
    }

    // Render comparison table
    function renderCompare() {
        const tbody = document.getElementById('compare-tbody');
        tbody.innerHTML = DATA.options.map(opt => `
            <tr style="${opt.recommended ? 'background: var(--success-light);' : ''}">
                <td class="mono">${opt.code}</td>
                <td>${opt.name}</td>
                <td class="mono" style="color: ${opt.debt_after === 0 ? 'var(--success)' : ''}">${fmt(opt.debt_after)}</td>
                <td class="mono" style="color: ${opt.cash_after > 0 ? 'var(--success)' : ''}">${fmt(opt.cash_after)}</td>
                <td><span class="badge ${riskBadge(opt.risk)}">${opt.risk}</span></td>
                <td class="mono">${opt.move_friction === 0 ? '-' : fmt(opt.move_friction)}</td>
            </tr>
        `).join('');
    }

    // Render stress test
    function renderStress() {
        const tbody = document.getElementById('stress-tbody');
        tbody.innerHTML = DATA.stress.map(s => {
            const runwayPct = typeof s.runway === 'number' ? Math.min(s.runway / 100 * 100, 100) : 100;
            const runwayColor = s.runway === '‚àû' ? 'var(--success)' : (s.runway > 50 ? 'var(--warning)' : 'var(--danger)');
            return `
                <tr>
                    <td>${s.option}</td>
                    <td class="mono">${fmt(s.weekly_mortgage)}</td>
                    <td class="mono" style="color: ${s.net_cashflow < 0 ? 'var(--danger)' : 'var(--success)'}">${s.net_cashflow === 0 ? '-' : fmt(s.net_cashflow)}</td>
                    <td class="mono" style="color: ${s.buffer > 0 ? 'var(--success)' : ''}">${s.buffer === 0 ? '-' : fmt(s.buffer)}</td>
                    <td>
                        <span style="color: ${runwayColor}; font-weight: 600;">${s.runway === '‚àû' ? '‚àû Safe' : s.runway + ' weeks'}</span>
                        <div class="runway-bar">
                            <div class="runway-fill" style="width: ${runwayPct}%; background: ${runwayColor}"></div>
                        </div>
                    </td>
                </tr>
            `;
        }).join('');

        const rateTbody = document.getElementById('rate-tbody');
        rateTbody.innerHTML = DATA.rates.map(r => `
            <tr>
                <td class="mono">${r.rate}</td>
                <td class="mono">${fmt(r.current)}</td>
                <td class="mono">${fmt(r.reduced)}</td>
                <td class="mono" style="color: var(--success)">${fmt(r.savings)}</td>
            </tr>
        `).join('');
    }

    // Render splits
    function renderSplits() {
        const grid = document.getElementById('split-grid');
        grid.innerHTML = DATA.splits.map(s => `
            <div class="split-card">
                <div class="split-rule">${s.rule}</div>
                <div style="font-size: 0.875rem; color: var(--text-muted);">${s.note}</div>
                <div class="split-values">
                    <div class="split-person">
                        <div class="split-name">Cassandra</div>
                        <div class="split-amount">${fmt(s.cassandra)}</div>
                    </div>
                    <div class="split-person">
                        <div class="split-name">Troy</div>
                        <div class="split-amount">${fmt(s.troy)}</div>
                    </div>
                </div>
            </div>
        `).join('');
    }

    // Select option as preference
    function selectOption(code) {
        localStorage.setItem('property_preference', code);
        renderOptions();
        updatePreferenceDisplay();
        showToast(`Option ${code} marked as preference`);
    }

    // Update preference display
    function updatePreferenceDisplay() {
        const pref = localStorage.getItem('property_preference');
        const displays = ['preference-display', 'preference-display-options'];
        
        displays.forEach(id => {
            const el = document.getElementById(id);
            if (el) {
                if (pref) {
                    const opt = DATA.options.find(o => o.code === pref);
                    el.innerHTML = `
                        <div class="preference-banner">
                            <span class="preference-text">‚úÖ Your preference: <strong>${opt.code} - ${opt.name}</strong></span>
                            <button class="clear-pref" onclick="clearPreference()">Clear</button>
                        </div>
                    `;
                } else {
                    el.innerHTML = '';
                }
            }
        });
    }

    // Clear preference
    function clearPreference() {
        localStorage.removeItem('property_preference');
        renderOptions();
        updatePreferenceDisplay();
        showToast('Preference cleared');
    }

    // Show section
    function showSection(sectionId) {
        document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
        document.getElementById(sectionId).classList.add('active');
        
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.classList.remove('active');
            btn.setAttribute('aria-selected', 'false');
            if (btn.dataset.section === sectionId) {
                btn.classList.add('active');
                btn.setAttribute('aria-selected', 'true');
            }
        });
    }

    // Toggle FAB menu
    function toggleFab() {
        const options = document.getElementById('fab-options');
        const btn = document.querySelector('.fab-btn');
        options.classList.toggle('open');
        btn.setAttribute('aria-expanded', options.classList.contains('open'));
    }

    // Show toast
    function showToast(message) {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 3000);
    }

    // Chat functions
    function askQuestion(q) {
        document.getElementById('chat-input').value = q;
        sendChat();
    }

    function sendChat() {
        const input = document.getElementById('chat-input');
        const q = input.value.trim();
        if (!q) return;

        const messages = document.getElementById('chat-messages');
        messages.innerHTML += `<div class="chat-message user"><div class="chat-bubble">${q}</div></div>`;

        // Find answer
        let answer = DATA.qa.default;
        const ql = q.toLowerCase();
        if (ql.includes('safe')) answer = DATA.qa.safest;
        else if (ql.includes('b2') || ql.includes('keep') && ql.includes('both')) answer = DATA.qa.b2;
        else if (ql.includes('rate') || ql.includes('interest') || ql.includes('7.5') || ql.includes('8%')) answer = DATA.qa.rate;
        else if (ql.includes('split') || ql.includes('divide') || ql.includes('fair')) answer = DATA.qa.split;
        else if (ql.includes('friction') || ql.includes('move') || ql.includes('moving')) answer = DATA.qa.friction;
        else if (ql.includes('peninsular') || ql.includes('why sell')) answer = DATA.qa.peninsular;

        setTimeout(() => {
            messages.innerHTML += `<div class="chat-message assistant"><div class="chat-bubble">${answer}</div></div>`;
            messages.scrollTop = messages.scrollHeight;
        }, 300);

        input.value = '';
    }

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
            const tabs = [...document.querySelectorAll('.nav-btn')];
            const current = tabs.findIndex(t => t.classList.contains('active'));
            if (current >= 0) {
                const next = e.key === 'ArrowRight' 
                    ? (current + 1) % tabs.length 
                    : (current - 1 + tabs.length) % tabs.length;
                tabs[next].click();
                tabs[next].focus();
            }
        }
    });

    // Init
    document.addEventListener('DOMContentLoaded', () => {
        renderOptions();
        renderCompare();
        renderStress();
        renderSplits();
        updatePreferenceDisplay();
        
        // Hide loading
        setTimeout(() => {
            document.getElementById('loading').classList.add('hidden');
        }, 500);
    });
    </script>
</body>
</html>